<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <link href="https://fonts.googleapis.com/css2?family=Comic+Neue:wght@400;700&family=Kosugi+Maru&display=swap" rel="stylesheet">
    <title>Ëã±Ê§ú4Á¥ö„Åß„ÇãÈ†Ü„Éë„ÇπÂçò - ÂâçÁΩÆË©û</title>
    <style>
        :root {
            --primary: #FF9800;
            --bg: #FFF8F0;
            --success: #2E7D32;
            --danger: #D32F2F;
            --accent: #5D4037;
            --font-main: 'Comic Neue', 'Kosugi Maru', sans-serif;
        }

        body {
            background-color: #fdf6ec;
            font-family: var(--font-main);
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .nav-container {
            position: sticky; top: 0; z-index: 1000; background: white; width: 100%;
            display: flex; justify-content: center; padding: 10px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1); gap: 10px;
        }

        .tab-btn {
            padding: 10px 20px; border: 2px solid var(--primary); background: white;
            color: var(--primary); border-radius: 30px; font-weight: bold; cursor: pointer;
            font-family: var(--font-main);
        }

        .tab-btn.active { background: var(--primary); color: white; }

        .top-controls { display: flex; gap: 10px; margin: 15px; flex-wrap: wrap; justify-content: center; }

        .action-btn { padding: 10px 18px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; color: white; font-family: var(--font-main); }
        .btn-check { background: var(--success); }
        .btn-reset { background: #9E9E9E; }
        .btn-print { background: var(--accent); }

        .content-section { display: none; width: 95%; max-width: 210mm; padding: 20px; box-sizing: border-box; }
        .content-section.active { display: block; }
        .page-card { background: white; padding: 30px; border-radius: 15px; min-height: 100vh; }

        h1 { text-align: center; color: var(--primary); font-family: var(--font-main); margin-bottom: 30px; }

        .matching-table { width: auto; margin: 0 auto 20px auto; border-collapse: collapse; }
        .matching-table td { padding: 6px 15px; border-bottom: 1px solid #eee; }
        .jp-text { min-width: 150px; font-size: 1.1rem; }
        .drop-target { 
            width: 100px; height: 35px; border-bottom: 2px solid var(--primary); 
            display: flex; align-items: center; justify-content: center; cursor: pointer;
            margin: 0 10px; color: black; font-size: 1.1rem; font-weight: bold;
        }

        /* --- Á©¥Âüã„ÇÅÔºö„Ç≥„É≥„ÉÜ„Éä„Çí‰∏≠Â§Æ„Å´ÂØÑ„Åõ„Å§„Å§‰∏≠Ë∫´„ÇíÂ∑¶ÊèÉ„Åà --- */
        .q-block { 
            margin: 0 auto 40px auto; 
            max-width: 500px; /* ÊñáÁ´†„ÅÆÈï∑„Åï„Å´Âêà„Çè„Åõ„Å¶„Ç≥„É≥„ÉÜ„ÉäÂπÖ„ÇíÂà∂Èôê */
            text-align: left; 
        }
        .bank { 
            margin: 0 auto 25px auto; 
            padding: 10px 20px; 
            border: 2px solid var(--primary); border-radius: 12px; 
            display: inline-flex; /* ÂπÖ„Çí‰∏≠Ë∫´„Å´Âêà„Çè„Åõ„Çã */
            justify-content: center; flex-wrap: wrap; gap: 15px;
            width: fit-content; min-width: 200px;
        }
        .bank-wrapper { text-align: center; width: 100%; margin-bottom: 20px; } /* „Éê„É≥„ÇØ„Çí‰∏≠Â§Æ„Å´ÁΩÆ„Åè„Åü„ÇÅ„ÅÆ„É©„ÉÉ„Éë„Éº */

        .sentence { font-size: 1.2rem; margin-bottom: 15px; cursor: pointer; line-height: 1.6; }
        .blank-space { 
            display: inline-block; min-width: 80px; border-bottom: 2px solid #333; 
            text-align: center; color: black; font-weight: bold; cursor: pointer; 
            margin: 0 5px; height: 1.2em; vertical-align: bottom; font-size: 1.2rem;
        }

        .word-chip { 
            display: inline-block; padding: 6px 16px; border: 2px solid var(--primary); 
            border-radius: 20px; cursor: pointer; background: white; 
            font-size: 1.1rem; font-weight: bold; transition: 0.2s;
        }
        .word-chip.selected { background: #FFF176; transform: scale(1.05); }
        .word-chip.used { opacity: 0.2; pointer-events: none; }

        @media print {
            .nav-container, .top-controls, .tab-btn, .action-btn { display: none !important; }
            body { background: white; font-family: var(--font-main); }
            .content-section { display: block !important; width: 100%; padding: 0; margin: 0; }
            .page-card { padding: 0; box-shadow: none; border: none; }
            h1 { font-size: 18pt; color: black; margin: 10px 0; }
            
            .matching-table { width: 95%; margin: 0 auto 15px auto; }
            .matching-table td { padding: 4px 10px; border: none !important; font-size: 12pt; }
            .drop-target { border-bottom: 1pt solid black !important; width: 120px; color: transparent !important; }
            
            .bank { 
                border: 1pt solid black !important; padding: 5px 15px; margin-bottom: 15px; 
                border-radius: 0; width: auto; max-width: 80%; display: inline-flex;
            }
            .word-chip { border: none !important; padding: 0 !important; font-size: 13pt; }
            .word-chip::after { content: "  /  "; }
            .word-chip:last-child::after { content: ""; }
            
            .q-block { margin: 0 auto 25px auto; padding: 0; page-break-inside: avoid; max-width: 80%; }
            .sentence { font-size: 13pt; margin-bottom: 8px; text-align: left; }
            .blank-space { border-bottom: 1pt solid black !important; color: transparent !important; }
        }
    </style>
</head>
<body>

<div class="nav-container">
    <button class="tab-btn active" onclick="switchTab('matching')">Matching</button>
    <button class="tab-btn" onclick="switchTab('Fill-in')">Fill-in</button>
</div>

<div class="top-controls">
    <button class="action-btn btn-check" onclick="checkAnswers()">Check Answers</button>
    <button class="action-btn btn-reset" onclick="resetAll()">Shuffle Questions</button>
    <button class="action-btn btn-print" onclick="window.print()">Print / PDF</button>
    <label><input type="checkbox" id="audioToggle" checked> üîä Audio</label>
</div>

<div id="matching" class="content-section active">
    <div class="page-card">
        <h1>Ëã±Ê§ú4Á¥ö„Åß„ÇãÈ†Ü„Éë„ÇπÂçò - ÂâçÁΩÆË©û</h1>
        <div id="matching-container"></div>
    </div>
</div>

<div id="filling" class="content-section">
    <div class="page-card">
        <h1>Ëã±Ê§ú4Á¥ö„Åß„ÇãÈ†Ü„Éë„ÇπÂçò - ÂâçÁΩÆË©û</h1>
        <div id="filling-container"></div>
    </div>
</div>

<script>
const data = [
    {en: "at", jp: "„Äú„Å´ÔºàÂú∞ÁÇπÔºâ„ÄÅ„Äú„Åß"}, {en: "in", jp: "„Äú„ÅÆ‰∏≠„Å´„ÄÅ„Äú„Å´ÔºàÊúüÈñìÔºâ"},
    {en: "for", jp: "„Äú„ÅÆ„Åü„ÇÅ„Å´„ÄÅ„Äú„ÅÆÈñì"}, {en: "on", jp: "„Äú„ÅÆ‰∏ä„Å´„ÄÅ„Äú„Å´ÔºàÊõúÊó•„ÉªÊó•‰ªòÔºâ"},
    {en: "of", jp: "„Äú„ÅÆ„ÄÅ„Äú„ÅÆ‰∏≠„Åß"}, {en: "about", jp: "„Äú„Å´„Å§„ÅÑ„Å¶„ÄÅ„Åä„Çà„Åù"},
    {en: "with", jp: "„Äú„Å®‰∏ÄÁ∑í„Å´„ÄÅ„Äú„ÇíÊåÅ„Å£„Å¶"}, {en: "after", jp: "„Äú„ÅÆÂæå„Å´"},
    {en: "by", jp: "„Äú„ÅÆ„Åù„Å∞„Å´„ÄÅ„Äú„Åæ„Åß„Å´"}, {en: "under", jp: "„Äú„ÅÆ‰∏ã„Å´"},
    {en: "over", jp: "„Äú„ÇíË∂ä„Åà„Å¶„ÄÅ„Äú‰ª•‰∏ä„ÅÆ"}, {en: "around", jp: "„Äú„ÅÆÂë®„Çä„Å´"},
    {en: "beside", jp: "„Äú„ÅÆ„Åù„Å∞„Å´"}, {en: "between", jp: "Ôºà2„Å§„ÅÆÔºâÈñì„Å´"},
    {en: "into", jp: "„Äú„ÅÆ‰∏≠„Å∏"}, {en: "until", jp: "„Äú„Åæ„ÅßÔºà„Åö„Å£„Å®Ôºâ"},
    {en: "before", jp: "„Äú„ÅÆÂâç„Å´"}, {en: "during", jp: "„Äú„ÅÆÈñìÔºà„Åö„Å£„Å®Ôºâ"},
    {en: "across", jp: "„Äú„ÇíÊ®™Âàá„Å£„Å¶"}, {en: "through", jp: "„Äú„ÇíÈÄö„ÇäÊäú„Åë„Å¶"}
];

const sentences = [
    {ans: "at", text: "Look [B] the blackboard."}, {ans: "in", text: "I live [B] Tokyo."},
    {ans: "for", text: "I waited [B] ten minutes."}, {ans: "on", text: "The book is [B] the desk."},
    {ans: "of", text: "He is a member [B] the club."}, {ans: "about", text: "We talked [B] the movie."},
    {ans: "with", text: "I play tennis [B] him."}, {ans: "after", text: "I'll go there [B] school."},
    {ans: "by", text: "He went to the sea [B] bus."}, {ans: "under", text: "There is a ball [B] the chair."},
    {ans: "over", text: "He is [B] thirteen years old."}, {ans: "around", text: "They sat [B] the table."},
    {ans: "beside", text: "Come and sit [B] me."}, {ans: "between", text: "A is [B] B and C."},
    {ans: "into", text: "He went [B] the room."}, {ans: "until", text: "I stayed home [B] five."},
    {ans: "before", text: "Wash your hands [B] lunch."}, {ans: "during", text: "He slept [B] the class."},
    {ans: "across", text: "She ran [B] the street."}, {ans: "through", text: "Go [B] this gate."}
];

let selectedWord = null;

function speakContextual(element, originalText) {
    if (!document.getElementById('audioToggle').checked) return;
    const blankElement = element.querySelector('.blank-space');
    const userChoice = blankElement ? blankElement.textContent.trim() : "";
    const wordToRead = userChoice !== "" ? userChoice : "blank";
    const fullSpeech = originalText.replace("[B]", wordToRead);

    window.speechSynthesis.cancel();
    let u = new SpeechSynthesisUtterance(fullSpeech);
    u.lang = 'en-US';
    window.speechSynthesis.speak(u);
}

function switchTab(id) {
    document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
    const targetId = (id === 'Fill-in') ? 'filling' : 'matching';
    document.getElementById(targetId).classList.add('active');
    event.currentTarget.classList.add('active');
}

function shuffle(arr) { return [...arr].sort(() => Math.random() - 0.5); }

function resetAll() {
    renderMatching();
    renderFilling();
    selectedWord = null;
}

function renderMatching() {
    const container = document.getElementById('matching-container');
    container.innerHTML = '';
    const items = shuffle(data).slice(0, 18);
    const sets = [items.slice(0, 6), items.slice(6, 12), items.slice(12, 18)];
    
    sets.forEach(set => {
        const table = document.createElement('table');
        table.className = 'matching-table';
        const pOrder = shuffle(set);
        const cOrder = shuffle(set.map(i => i.en));
        pOrder.forEach((item, i) => {
            const tr = document.createElement('tr');
            tr.innerHTML = `<td class="jp-text">${item.jp}</td>
                <td><div class="drop-target" data-ans="${item.en}" onclick="dropWord(this)"></div></td>
                <td><div class="word-chip" onclick="pickWord(this)">${cOrder[i]}</div></td>`;
            table.appendChild(tr);
        });
        container.appendChild(table);
    });
}

function renderFilling() {
    const container = document.getElementById('filling-container');
    container.innerHTML = '';
    const qItems = shuffle(sentences).slice(0, 18);
    const sets = [qItems.slice(0, 6), qItems.slice(6, 12), qItems.slice(12, 18)];

    sets.forEach(set => {
        const block = document.createElement('div');
        block.className = 'q-block';
        
        const bankWrapper = document.createElement('div');
        bankWrapper.className = 'bank-wrapper';
        const bank = document.createElement('div');
        bank.className = 'bank';
        shuffle(set.map(s => s.ans)).forEach(word => {
            bank.innerHTML += `<div class="word-chip" onclick="pickWord(this)">${word}</div>`;
        });
        bankWrapper.appendChild(bank);
        block.appendChild(bankWrapper);

        shuffle(set).forEach(s => {
            const div = document.createElement('div');
            div.className = 'sentence';
            div.innerHTML = s.text.replace('[B]', `<span class="blank-space" data-ans="${s.ans}" onclick="dropWord(this)"></span>`);
            div.onclick = (e) => { if(e.target.className !== 'blank-space') speakContextual(div, s.text); };
            block.appendChild(div);
        });
        container.appendChild(block);
    });
}

function pickWord(el) {
    if (selectedWord) selectedWord.classList.remove('selected');
    selectedWord = el;
    el.classList.add('selected');
    if (document.getElementById('audioToggle').checked) {
        window.speechSynthesis.cancel();
        let u = new SpeechSynthesisUtterance(el.textContent);
        u.lang = 'en-US'; window.speechSynthesis.speak(u);
    }
}

function dropWord(target) {
    if (selectedWord) {
        if (target.textContent) restoreWord(target.textContent);
        target.textContent = selectedWord.textContent;
        target.style.color = "black";
        selectedWord.classList.add('used');
        selectedWord.classList.remove('selected');
        selectedWord = null;
    } else if (target.textContent) {
        restoreWord(target.textContent);
        target.textContent = '';
    }
}

function restoreWord(txt) {
    document.querySelectorAll('.word-chip.used').forEach(chip => {
        if(chip.textContent === txt) chip.classList.remove('used');
    });
}

function checkAnswers() {
    let allCorrect = true;
    document.querySelectorAll('.drop-target, .blank-space').forEach(el => {
        const user = el.textContent.trim();
        const correct = el.getAttribute('data-ans');
        if (user === "") { allCorrect = false; return; }
        
        if (user === correct) {
            el.style.color = "var(--success)";
        } else {
            el.style.color = "var(--danger)";
            allCorrect = false;
        }
    });
    if(allCorrect) alert("Á¥†Êô¥„Çâ„Åó„ÅÑÔºÅÂÖ®ÂïèÊ≠£Ëß£„Åß„ÅôÔºÅ");
}

window.onload = resetAll;
</script>
</body>
</html>